generate_pr() {
    # 0. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è gh (GitHub CLI)
    if ! command -v gh &> /dev/null; then
        echo "Error: GitHub CLI (gh) is not installed. Please install it to create PRs."
        return 1
    fi

    git add .
    # –ü–æ–ª—É—á–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    DIFF=$(git diff --cached)

    if [ -z "$DIFF" ]; then
        echo "No staged changes found. Please stage your changes first using 'git add'"
        return 1
    fi

    echo "ü§ñ Analyzing changes..."

    # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è –≤–µ—Ç–∫–∏ (kebab-case)
    BRANCH_NAME=$(echo "$DIFF" | llm -m gemini "Generate a short, concise git branch name using kebab-case based on these changes. Output ONLY the branch name, no markdown, no explanations.")
    
    # –û—á–∏—Å—Ç–∫–∞ –∏–º–µ–Ω–∏ –≤–µ—Ç–∫–∏ –æ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏–ª–∏ –∫–∞–≤—ã—á–µ–∫
    BRANCH_NAME=$(echo "$BRANCH_NAME" | tr -d '[:space:]"`')

    if [ -z "$BRANCH_NAME" ]; then
        echo "Failed to generate branch message"
        return 1
    fi

    echo "üåø Creating branch: $BRANCH_NAME"
    git checkout -b "$BRANCH_NAME"

    # 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
    COMMIT_MSG=$(echo "$DIFF" | llm -m gemini "Generate a concise commit message (first line) and detailed description (separated by blank line) based on these changes.")

    if [ -z "$COMMIT_MSG" ]; then
        echo "Failed to generate commit message"
        return 1
    fi

    # 3. –î–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç
    git commit -m "$COMMIT_MSG"

    # 4. –ü—É—à–∏–º –≤–µ—Ç–∫—É
    echo "üöÄ Pushing branch..."
    git push -u origin "$BRANCH_NAME"

    # 5. –°–æ–∑–¥–∞–µ–º PR
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∫–æ–º–º–∏—Ç–∞ –∫–∞–∫ –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∫–∞–∫ —Ç–µ–ª–æ
    PR_TITLE=$(echo "$COMMIT_MSG" | head -n 1)
    PR_BODY=$(echo "$COMMIT_MSG" | tail -n +3)

    echo "üîó Creating Pull Request..."
    gh pr create --title "$PR_TITLE" --body "$PR_BODY" --web
}

generate_pr