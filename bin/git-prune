#!/usr/bin/env bash

set -e

echo "üîÑ Fetching all branches..."
git fetch --all --prune

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–∞–≤–Ω—É—é –≤–µ—Ç–∫—É
MAIN_BRANCH=""
if git show-ref --quiet refs/heads/main; then
    MAIN_BRANCH="main"
elif git show-ref --quiet refs/heads/master; then
    MAIN_BRANCH="master"
else
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É (main/master)."
    exit 1
fi

echo "‚û°Ô∏è Switching to $MAIN_BRANCH..."
git checkout "$MAIN_BRANCH"

echo "üßπ Removing merged local branches..."
git branch --merged | grep -v "$MAIN_BRANCH" | xargs -r git branch -d

echo "üóë Cleaning remote tracking branches..."
git remote prune origin

echo "‚úÖ Done! –ú–µ—Ä–∂–µ–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏ —É–¥–∞–ª–µ–Ω—ã."

